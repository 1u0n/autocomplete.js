"use strict";function attr(a,b){if(null!=a){if("string"==typeof b)return a.getAttribute(b);for(var c in b)a.setAttribute(c,b[c])}}function domCreate(a){return document.createElement(a)}function merge(a,b){var c={};for(var d in a)c[d]=a[d];for(var e in b)c[e]=b[e];return c}var AutoComplete=function(a){if(this){this._args=a,this._custArgs=[],this.Init();for(var b=this._args.selector.length-1;b>=0;b--)this.BindCollection(this,this._args.selector[b])}else new AutoComplete(a)};AutoComplete.prototype={Ajax:function(a,b,c,d,e){a&&a.abort();var f=b.method,g=b.url;return f.match(/^GET$/i)&&(g+="?"+c),a=new XMLHttpRequest,a.open(f,g,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&b.post(e,a.response,b)!==!0&&b.open(d,e)},a.send(c),a},BindCollection:function(a,b){for(var c,d=document.querySelectorAll(b),e=d.length-1;e>=0;e--)c=d[e],c.nodeName.match(/^INPUT$/i)&&(c.type.match(/^TEXT$/i)||c.type.match(/^SEARCH$/i))&&this.BindOne(a,c)},BindOne:function(a,b){if(b){var c,d="data-autocomplete-old-value",e=this,f=domCreate("div");attr(b,{autocomplete:"off"}),e.Position(b,f),b.addEventListener("autocomplete:position",function(){e.Position(b,f)}),b.parentNode.appendChild(f),b.addEventListener("focus",function(){var a=attr(b,d);a&&b.value==a||attr(f,{"class":"autocomplete open"})}),b.addEventListener("blur",function(){e.Close(f)}),b.addEventListener("keyup",function(b){var g=b.keyCode;if(13==g&&-1!=f.getAttribute("class").indexOf("open")){var h=f.querySelector("li.active");null!=h&&(a._args.select(b.currentTarget,h),attr(f,{"class":"autocomplete"}))}if(38==g||40==g){var h=f.querySelector("li.active");if(null==h){var i=f.querySelector("li:first-child:not(.locked)");null!=i&&attr(i,{"class":"active"})}else{var j=Array.prototype.indexOf.call(h.parentNode.children,h);attr(h,{"class":""});var k=j+(g-39),l=f.getElementsByTagName("li").length;0>k?k=l-1:k>=l&&(k=0),attr(h.parentElement.childNodes.item(k),{"class":"active"})}}else if(35>g||g>40){var m=b.currentTarget,n=e.CustParams(m),o=n.pre(m);if(o&&n.url){var p=attr(m,d);p&&o==p||attr(f,{"class":"autocomplete open"}),c=e.Ajax(c,n,n.paramName+"="+o,m,f)}}})}},Close:function(a,b){var c=this;b?attr(a,{"class":"autocomplete"}):setTimeout(function(){c.Close(a,!0)},150)},CreateCustParams:function(a){for(var b={limit:"data-autocomplete-limit",method:"data-autocomplete-method",noResult:"data-autocomplete-no-result",paramName:"data-autocomplete-param-name",url:"data-autocomplete"},c=this,d=Object.getOwnPropertyNames(b),e=d.length-1;e>=0;e--)b[d[e]]=attr(a,b[d[e]]);for(var f in b)b.hasOwnProperty(f)&&!b[f]&&delete b[f];return b.method&&!b.method.match(/^GET|POST$/i)&&delete b.method,b.limit&&(isNaN(b.limit)?delete b.limit:b.limit=parseInt(b.limit)),merge(c._args,b)},CustParams:function(a){var b="data-autocomplete-id",c=this;return a.hasAttribute(b)||(a.setAttribute(b,c._custArgs.length),c._custArgs.push(c.CreateCustParams(a))),c._custArgs[attr(a,b)]},Init:function(){var a=this,b={limit:0,method:"GET",noResult:"No result",paramName:"q",select:function(a,b){var c="data-autocomplete-value";a.value=b.hasAttribute(c)?attr(b,c):b.innerHTML,attr(a,{"data-autocomplete-old-value":a.value})},open:function(a,b){for(var c=function(b,c){c.addEventListener("click",function(c){b.select(a,c.currentTarget)})},d=b.getElementsByTagName("li"),e=d.length-1;e>=0;e--)c(this,d[e])},post:function(a,b,c){try{b=JSON.parse(b);var d,e=b.length,f=domCreate("li"),g=domCreate("ul");if(Array.isArray(b))if(e){c.limit<0&&b.reverse();for(var h=0;e>h&&(h<Math.abs(c.limit)||!c.limit);h++)f.innerHTML=b[h],g.appendChild(f),f=domCreate("li")}else d=!0,attr(f,{"class":"locked"}),f.innerHTML=c.noResult,g.appendChild(f);else{var i=Object.getOwnPropertyNames(b);c.limit<0&&i.reverse();for(var j in i)(parseInt(j)<Math.abs(c.limit)||!c.limit)&&(f.innerHTML=b[i[j]],attr(f,{"data-autocomplete-value":i[j]}),g.appendChild(f),f=domCreate("li"))}return a.hasChildNodes()&&a.childNodes[0].remove(),a.appendChild(g),d}catch(k){a.innerHTML=b}},pre:function(a){return a.value},selector:["input[data-autocomplete]"]};void 0===a._args&&(a._args={}),a._args=merge(b,a._args),a._args.method.match(/^GET|POST$/i)||(a._args.method=b.method),Array.isArray(a._args.selector)||(a._args.selector=b.selector)},Position:function(a,b){attr(b,{"class":"autocomplete",style:"top:"+(a.offsetTop+a.offsetHeight)+"px;left:"+a.offsetLeft+"px;width:"+a.clientWidth+"px;"})}};
//# sourceMappingURL=autocomplete.min.js.map