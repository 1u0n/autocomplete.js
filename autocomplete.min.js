/* Autocomplete.js v1.4.0 unstable developed by Baptiste Donaux | Under MITÂ Licence | (c) 2014, Baptiste Donaux */
var AutoComplete=function(e){this.Ajax=function(e,t,n,r,i){if(e){e.abort()}var s=t.method,o=t.url;if(s.match("^GET$","i")){o+="?"+n}e=new XMLHttpRequest;e.open(s,o,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.setRequestHeader("Content-length",n.length);e.setRequestHeader("Connection","close");e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){if(t.post(i,e.response,t)!==true){t.open(r,i)}}};e.send(n);return e};this.BindCollection=function(e){var t,n=document.querySelectorAll(e);for(var r=n.length-1;r>=0;r--){t=n[r];if(t.nodeName.match("^INPUT$","i")&&t.type.match("^TEXT$","i")){BindOne(t)}}};this.BindOne=function(e){if(e){var t="data-autocomplete-old-value",n=document.createElement("div"),r;Attributes(n,{autocomplete:"off","class":"autocomplete",style:"top:"+(e.offsetTop+e.offsetHeight)+"px;left:"+e.offsetLeft+"px;width:"+e.clientWidth+"px;"});e.parentNode.appendChild(n);e.addEventListener("focus",function(){var r=e.getAttribute(t);if(!r||e.value!=r){n.setAttribute("class","autocomplete open")}});e.addEventListener("blur",function(){Close(n)});e.addEventListener("keyup",function(e){var i=e.currentTarget,s=CustParams(i),o=s.pre(i);if(o&&s.url){var u=i.getAttribute(t);if(!u||o!=u){n.setAttribute("class","autocomplete open")}r=Ajax(r,s,s.paramName+"="+o,i,n)}})}};this.Close=function(e,t){t?e.setAttribute("class","autocomplete"):setTimeout(function(){Close(e,true)},150)};this.Initialize=function(){var e={limit:0,method:"GET",noResult:"No result",paramName:"q",open:function(e,t){var n=t.getElementsByTagName("li");for(var r=n.length-1;r>=0;r--){n[r].addEventListener("click",function(t){var n=t.currentTarget,r="data-autocomplete-value";e.value=n.hasAttribute(r)?n.getAttribute(r):n.innerHTML;e.setAttribute("data-autocomplete-old-value",e.value)})}},post:function(e,t,n){if(n.type.match("^HTML$","i")){e.innerHTML=t}else{t=JSON.parse(t);var r,i=t.length,s=document.createElement("li"),o=document.createElement("ul");if(Array.isArray(t)){if(i){if(n.limit<0){t.reverse()}for(var u=0;u<i&&(u<Math.abs(n.limit)||!n.limit);u++){s.innerHTML=t[u];o.appendChild(s);s=document.createElement("li")}}else{r=true;s.setAttribute("class","locked");s.innerHTML=n.noResult;o.appendChild(s)}}else{var a=Object.getOwnPropertyNames(t);if(n.limit<0){a.reverse()}for(var f in a){if(parseInt(f)<Math.abs(n.limit)||!n.limit){s.innerHTML=t[a[f]];s.setAttribute("data-autocomplete-value",a[f]);o.appendChild(s);s=document.createElement("li")}}}if(e.hasChildNodes()){e.childNodes[0].remove()}e.appendChild(o);return r}},pre:function(e){return e.value},type:"JSON",selector:["input[data-autocomplete]"]};if(this.params===undefined){this.params={}}this.params=Merge(e,this.params);if(!this.params.method.match("^GET|POST$","i")){this.params.method=e.method}if(!this.params.type.match("^JSON|HTML$","i")){this.params.type=e.type}if(!Array.isArray(this.params.selector)){this.params.selector=e.selector}};this.CreateCustParams=function(e){var t={limit:"data-autocomplete-limit",method:"data-autocomplete-method",noResult:"data-autocomplete-no-result",paramName:"data-autocomplete-param-name",type:"data-autocomplete-type",url:"data-autocomplete"};var n=Object.getOwnPropertyNames(t);for(var r=n.length-1;r>=0;r--){t[n[r]]=e.getAttribute(t[n[r]])}for(var i in t){if(t.hasOwnProperty(i)&&!t[i]){delete t[i]}}if(t.method&&!t.method.match("^GET|POST$","i")){delete t.method}if(t.type&&!t.type.match("^JSON|HTML$","i")){delete t.type}if(t.limit){isNaN(t.limit)?delete t.limit:t.limit=parseInt(t.limit)}return Merge(this.params,t)};this.CustParams=function(e){var t="data-autocomplete-id";if(!e.hasAttribute(t)){e.setAttribute(t,this.custParams.length);this.custParams.push(CreateCustParams(e))}return this.custParams[e.getAttribute(t)]};this.Merge=function(e,t){var n={};for(var r in e){n[r]=e[r]}for(var r in t){n[r]=t[r]}return n};this.Attributes=function(e,t){for(var n in t){e.setAttribute(n,t[n])}};this.params=e;this.custParams=new Array;this.Initialize();for(var t=this.params.selector.length-1;t>=0;t--){this.BindCollection(this.params.selector[t])}}