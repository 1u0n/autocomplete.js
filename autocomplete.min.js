/* Autocomplete.js v1.3.0 unstable developed by Baptiste Donaux | Under MITÂ Licence | (c) 2014, Baptiste Donaux */
var AutoComplete=function(e){this.Ajax=function(e,t,n,r,i){if(e!==undefined){e.abort()}var s=t.url;if(t.method==="GET"){s=t.url+"?"+n}e=new XMLHttpRequest;e.open(t.method,s,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.setRequestHeader("Content-length",n.length);e.setRequestHeader("Connection","close");e.onreadystatechange=function(){if(e.readyState===4&&e.status===200){if(t.type==="HTML"){i.innerHTML=e.response}else{var n=false,s,o=JSON.parse(e.response),u=document.createElement("ul");if(Object.prototype.toString.call(o)==="[object Array]"){if(o.length!==0){for(var a=0;a<o.length;a++){s=document.createElement("li");s.innerHTML=o[a];u.appendChild(s)}}else{n=true;s=document.createElement("li");s.setAttribute("class","locked");s.innerHTML=t.noResult;u.appendChild(s)}}else{for(var f in o){if(o.hasOwnProperty(f)){s=document.createElement("li");s.innerHTML=o[f];s.setAttribute("data-autocomplete-value",f);u.appendChild(s)}}}if(i.hasChildNodes()){i.childNodes[0].remove()}i.appendChild(u)}if(n===false){Result(r,i)}}};e.send(n);return e};this.BindCollection=function(e){var t=null,n=document.querySelectorAll(e);for(var r=n.length-1;r>=0;r--){t=n[r];if(t.nodeName.toUpperCase()==="INPUT"&&t.type.toUpperCase()==="TEXT"){BindOne(t)}}};this.BindOne=function(e){if(e!=null){var t=this.params,n=document.createElement("div"),r,i=e.offsetTop+e.offsetHeight,s;n.setAttribute("class","resultsAutocomplete");n.setAttribute("style","top:"+i+"px;left:"+e.offsetLeft+"px;width:"+e.clientWidth+"px;");e.parentNode.appendChild(n);e.setAttribute("autocomplete","off");e.addEventListener("focus",function(t){var r=e.getAttribute("data-autocomplete-old-value");if(r===null||e.value!==r){n.setAttribute("class","resultsAutocomplete open")}});e.addEventListener("blur",function(e){Close(n)});e.addEventListener("keyup",function(e){var t=e.currentTarget,i=t.value;if(i!==""){var s=FindCustomParams(t),o=s.paramName+"="+i;if(s.url){var u=t.getAttribute("data-autocomplete-old-value");if(u===null||i!==u){n.setAttribute("class","resultsAutocomplete open")}r=Ajax(r,s,o,t,n)}}})}};this.Close=function(e,t){if(t===true){e.setAttribute("class","resultsAutocomplete")}else{setTimeout(function(){Close(e,true)},100)}};this.Initialize=function(){if(this.params===undefined){this.params={}}if(this.params.method===undefined||this.params.method.toUpperCase()!=="GET"&&this.params.method.toUpperCase()!=="POST"){this.params.method="GET"}else{this.params.method=this.params.method.toUpperCase()}if(this.params.paramName===undefined){this.params.paramName="q"}if(this.params.selector===undefined){this.params.selector=["input[data-autocomplete]"]}if(this.params.type===undefined||this.params.type.toUpperCase()!=="JSON"&&this.params.type.toUpperCase()!=="HTML"){this.params.type="JSON"}else{this.params.type=this.params.type.toUpperCase()}if(this.params.noResult===undefined){this.params.noResult="No result"}};this.GenerateCustomParams=function(e){var t={url:e.getAttribute("data-autocomplete"),method:e.getAttribute("data-autocomplete-method"),paramName:e.getAttribute("data-autocomplete-param-name"),type:e.getAttribute("data-autocomplete-type"),noResult:e.getAttribute("data-autocomplete-no-result")};for(var n in t){if(t.hasOwnProperty(n)&&t[n]===null){delete t[n]}}if(t.method){if(t.method.toUpperCase()!=="GET"&&t.method.toUpperCase()!=="POST"){delete t.method}else{t.method=t.method.toUpperCase()}}if(t.type){if(t.type.toUpperCase()!=="JSON"&&t.type.toUpperCase()!=="HTML"){delete t.type}else{t.type=t.type.toUpperCase()}}var r={};for(var i in this.params){r[i]=this.params[i]}for(var i in t){r[i]=t[i]}return r};this.FindCustomParams=function(e){if(e.hasAttribute("data-autocomplete-id")){return this.customParams[e.getAttribute("data-autocomplete-id")]}else{e.setAttribute("data-autocomplete-id",this.customParams.length);var t=GenerateCustomParams(e);this.customParams.push(t);return t}};this.Result=function(e,t){var n=t.getElementsByTagName("li");for(var r=n.length-1;r>=0;r--){n[r].addEventListener("click",function(t){var n=t.currentTarget;if(n.hasAttribute("data-autocomplete-value")){e.value=n.getAttribute("data-autocomplete-value")}else{e.value=n.innerHTML}e.setAttribute("data-autocomplete-old-value",e.value)})}};this.params=e;this.customParams=new Array;this.Initialize();for(var t=this.params.selector.length-1;t>=0;t--){this.BindCollection(this.params.selector[t])}}