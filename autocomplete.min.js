// Autocomplete.js v1.4.0 unstable | Under MIT Licence | 2014 Baptiste Donaux
"use strict";var AutoComplete=function(e){this.params=e;this.custParams=[];this.Init();for(var t=this.params.selector.length-1;t>=0;t--){this.BindCollection(this.params.selector[t])}};AutoComplete.prototype.BindOne=function(e){if(e){var t="data-autocomplete-old-value",n=this.DOMCreate("div"),r;this.Attr(e,{autocomplete:"off"});this.Position(e,n);e.addEventListener("autocomplete:position",function(){this.Position(e,n)});e.parentNode.appendChild(n);var i=this;e.addEventListener("focus",function(){var r=i.Attr(e,t);if(!r||e.value!=r){i.Attr(n,{"class":"autocomplete open"})}});e.addEventListener("blur",function(){i.Close(n)});e.addEventListener("keyup",function(e){var s=e.currentTarget,o=i.CustParams(s),u=o.pre(s);if(u&&o.url){var a=i.Attr(s,t);if(!a||u!=a){i.Attr(n,{"class":"autocomplete open"})}r=i.Ajax(r,o,o.paramName+"="+u,s,n)}})}};AutoComplete.prototype.DOMCreate=function(e){return document.createElement(e)};AutoComplete.prototype.Ajax=function(e,t,n,r,i){if(e){e.abort()}var s=t.method,o=t.url;if(s.match(/^GET$/i)){o+="?"+n}e=new XMLHttpRequest;e.open(s,o,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.setRequestHeader("Content-length",n.length);e.setRequestHeader("Connection","close");e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){if(t.post(i,e.response,t)!==true){t.open(r,i)}}};e.send(n);return e};AutoComplete.prototype.BindCollection=function(e){var t,n=document.querySelectorAll(e);for(var r=n.length-1;r>=0;r--){t=n[r];if(t.nodeName.match(/^INPUT$/i)&&t.type.match(/^TEXT$/i)){this.BindOne(t)}}};AutoComplete.prototype.Position=function(e,t){this.Attr(t,{"class":"autocomplete",style:"top:"+(e.offsetTop+e.offsetHeight)+"px;left:"+e.offsetLeft+"px;width:"+e.clientWidth+"px;"})};AutoComplete.prototype.Close=function(e,t){if(t){this.Attr(e,{"class":"autocomplete"})}else{var n=this;setTimeout(function(){n.Close(e,true)},150)}};AutoComplete.prototype.Init=function(){var e=this,t={limit:0,method:"GET",noResult:"No result",paramName:"q",open:function(t,n){var r=function(n){n.addEventListener("click",function(n){var r=n.currentTarget,i="data-autocomplete-value";t.value=r.hasAttribute(i)?e.Attr(r,i):r.innerHTML;e.Attr(t,{"data-autocomplete-old-value":t.value})})};var i=n.getElementsByTagName("li");for(var s=i.length-1;s>=0;s--){r(i[s])}},post:function(t,n,r){try{n=JSON.parse(n);var i,s=n.length,o=e.DOMCreate("li"),u=e.DOMCreate("ul");if(Array.isArray(n)){if(s){if(r.limit<0){n.reverse()}for(var a=0;a<s&&(a<Math.abs(r.limit)||!r.limit);a++){o.innerHTML=n[a];u.appendChild(o);o=e.DOMCreate("li")}}else{i=true;e.Attr(o,{"class":"locked"});o.innerHTML=r.noResult;u.appendChild(o)}}else{var f=Object.getOwnPropertyNames(n);if(r.limit<0){f.reverse()}for(var l in f){if(parseInt(l)<Math.abs(r.limit)||!r.limit){o.innerHTML=n[f[l]];e.Attr(o,{"data-autocomplete-value":f[l]});u.appendChild(o);o=e.DOMCreate("li")}}}if(t.hasChildNodes()){t.childNodes[0].remove()}t.appendChild(u);return i}catch(c){t.innerHTML=n}},pre:function(e){return e.value},selector:["input[data-autocomplete]"]};if(this.params===undefined){this.params={}}this.params=this.Merge(t,this.params);if(!this.params.method.match(/^GET|POST$/i)){this.params.method=t.method}if(!Array.isArray(this.params.selector)){this.params.selector=t.selector}};AutoComplete.prototype.CreateCustParams=function(e){var t={limit:"data-autocomplete-limit",method:"data-autocomplete-method",noResult:"data-autocomplete-no-result",paramName:"data-autocomplete-param-name",url:"data-autocomplete"};var n=Object.getOwnPropertyNames(t);for(var r=n.length-1;r>=0;r--){t[n[r]]=this.Attr(e,t[n[r]])}for(var i in t){if(t.hasOwnProperty(i)&&!t[i]){delete t[i]}}if(t.method&&!t.method.match(/^GET|POST$/i)){delete t.method}if(t.limit){if(isNaN(t.limit)){delete t.limit}else{t.limit=parseInt(t.limit)}}return this.Merge(this.params,t)};AutoComplete.prototype.CustParams=function(e){var t="data-autocomplete-id";if(!e.hasAttribute(t)){e.setAttribute(t,this.custParams.length);this.custParams.push(this.CreateCustParams(e))}return this.custParams[this.Attr(e,t)]};AutoComplete.prototype.Merge=function(e,t){var n={};for(var r in e){n[r]=e[r]}for(var i in t){n[i]=t[i]}return n};AutoComplete.prototype.Attr=function(e,t){if(typeof t=="string"){return e.getAttribute(t)}for(var n in t){e.setAttribute(n,t[n])}}