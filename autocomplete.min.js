/* Autocomplete.js v1.3.0 unstable developed by Baptiste Donaux | Under MITÂ Licence | (c) 2014, Baptiste Donaux */
var AutoComplete=function(e){this.Ajax=function(e,t,n,r,i){if(e){e.abort()}var s=t.method,o=t.url;if(s=="GET"){o+="?"+n}e=XMLHttpRequest();e.open(s,o,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.setRequestHeader("Content-length",n.length);e.setRequestHeader("Connection","close");e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){var n=e.response;if(t.type=="HTML"){i.innerHTML=n}else{n=JSON.parse(n);var s,o=n.length,u=document.createElement("li"),a=document.createElement("ul");if(Array.isArray(n)){if(o){for(var f=0;f<o;f++){u.innerHTML=n[f];a.appendChild(u);u=document.createElement("li")}}else{s=true;u.setAttribute("class","locked");u.innerHTML=t.noResult;a.appendChild(u)}}else{var l=Object.getOwnPropertyNames(n);for(var c in l){u.innerHTML=n[l[c]];u.setAttribute("data-autocomplete-value",l[c]);a.appendChild(u);u=document.createElement("li")}}if(i.hasChildNodes()){i.childNodes[0].remove()}i.appendChild(a)}if(s!==true){Open(r,i)}}};e.send(n);return e};this.BindCollection=function(e){var t,n=document.querySelectorAll(e);for(var r=n.length-1;r>=0;r--){t=n[r];if(t.nodeName.toUpperCase()=="INPUT"&&t.type.toUpperCase()=="TEXT"){BindOne(t)}}};this.BindOne=function(e){if(e){var t="data-autocomplete-old-value",n=document.createElement("div"),r;n.setAttribute("class","autocomplete");n.setAttribute("style","top:"+(e.offsetTop+e.offsetHeight)+"px;left:"+e.offsetLeft+"px;width:"+e.clientWidth+"px;");e.parentNode.appendChild(n);e.setAttribute("autocomplete","off");e.addEventListener("focus",function(){var r=e.getAttribute(t);if(!r||e.value!=r){n.setAttribute("class","autocomplete open")}});e.addEventListener("blur",function(){Close(n)});e.addEventListener("keyup",function(e){var i=e.currentTarget,s=i.value;if(s){var o=CustParams(i),u=o.paramName+"="+s;if(o.url){var a=i.getAttribute(t);if(!a||s!=a){n.setAttribute("class","autocomplete open")}r=Ajax(r,o,u,i,n)}}})}};this.Close=function(e,t){t?e.setAttribute("class","autocomplete"):setTimeout(function(){Close(e,true)},150)};this.Initialize=function(){var e={method:"GET",paramName:"q",selector:["input[data-autocomplete]"],type:"JSON",noResult:"No result"};if(this.params===undefined){this.params={}}this.params=Merge(e,this.params);this.params.method=this.params.method.toUpperCase();this.params.type=this.params.type.toUpperCase();if(!this.params.method.match("^GET|POST$")){this.params.method=e.method}if(!this.params.type.match("^JSON|HTML$")){this.params.type=e.type}if(!Array.isArray(this.params.selector)){this.params.selector=e.selector}};this.CreateCustParams=function(e){var t={url:e.getAttribute("data-autocomplete"),method:e.getAttribute("data-autocomplete-method"),paramName:e.getAttribute("data-autocomplete-param-name"),type:e.getAttribute("data-autocomplete-type"),noResult:e.getAttribute("data-autocomplete-no-result")};for(var n in t){if(t.hasOwnProperty(n)&&!t[n]){delete t[n]}}if(t.method){!t.method.match("^GET|POST$")?delete t.method:t.method=t.method.toUpperCase()}if(t.type){!t.type.match("^JSON|HTML$")?delete t.type:t.type=t.type.toUpperCase()}return Merge(this.params,t)};this.CustParams=function(e){var t="data-autocomplete-id";if(!e.hasAttribute(t)){e.setAttribute(t,this.custParams.length);this.custParams.push(CreateCustParams(e))}return this.custParams[e.getAttribute(t)]};this.Open=function(e,t){var n=t.getElementsByTagName("li");for(var r=n.length-1;r>=0;r--){n[r].addEventListener("click",function(t){var n=t.currentTarget,r="data-autocomplete-value";e.value=n.hasAttribute(r)?n.getAttribute(r):n.innerHTML;e.setAttribute("data-autocomplete-old-value",e.value)})}};this.Merge=function(e,t){var n={};for(var r in e){n[r]=e[r]}for(var r in t){n[r]=t[r]}return n};this.params=e;this.custParams=new Array;this.Initialize();for(var t=this.params.selector.length-1;t>=0;t--){this.BindCollection(this.params.selector[t])}}